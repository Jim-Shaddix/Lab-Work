clear
clc

%% Initialization
% These settings initialize the program, and our subject to change.

% SET: paths
addpath(genpath('Store_TDMS_Data')); % for reading tdms files
addpath(genpath('Fits'));            % for fitting Lorentzian to data
addpath(genpath('Plots'));           % for plotting data
addpath(genpath('Set_Peaks'));       % for setting peak values
addpath(genpath('Data_Manipulation')); % for reading tdms files

% SET: file paths
fp1 = ['~/Documents/Pro/Git/Repos/Lab-Work/docs/2-Files_To_Analyze/' ... 
       '31 May 18 TaV2/'];
fp2 = ['~/Documents/Pro/Git/Repos/Lab-Work/docs/2-Files_To_Analyze/' ... 
       '15 May 18 BalrO3/'];
fp3 = ['~/Documents/Pro/Git/Repos/Lab-Work/docs/2-Files_To_Analyze/' ... 
       'CoNb2O6 061218/'];
fp4 = ['~/Documents/Pro/Git/Repos/Lab-Work/docs/2-Files_To_Analyze/' ... 
       'More CoNb206/'];
path_to_tdms_files = fp1;

% findpeak options
find_peak_opts.MinPeakDistance   = 100;
find_peak_opts.MinPeakProminence = 0.0001;

% width of data to perform peak fit on
peak_width = 0.01*10^6;

clear fp1 fp2 fp3 fp4

%% Read In Data

% STORE: data from tdms files
tdms_data = TDMS_Load(path_to_tdms_files);
fprintf(' --- Finished: Reading Data ---\n\n')
%tdms_data = tdms_data([1:4]);

%% Set Struct
tdms_data = tdms_data([14,25]);

% GET: plot info
plot_info = Get_Plot_Struct();

% MODIFY: plot info
plot_info.preprocess = {@Process_Plot_Data};
plot_info.raw  = 1;
%plot_info.mag  = 1;
%plot_info.plot_width = 1;
plot_info.peaks_raw_given = [1,1];
%plot_info.peaks_mag_given = [1,1];
%plot_info.peaks_raw_set   = [1,1];
%plot_info.peaks_mag_set   = [1,1];

% SET: plot info
[tdms_data.plot_info] = deal(plot_info);

%% Process The Data
tdms_data = Process_Data(tdms_data);
fprintf(" --- Finished processing data --- \n\n")

%% Plot

%tdms_data(1) = Plot_Stuff(tdms_data(1),true);
tdms_data = Sub_Plots(tdms_data);

disp(" --- Finished: Plotting ---")

%% more stuff
%Plot_Width(tdms_data)
Plot_Single_Width(tdms_data)

%% Clean Up Variables
clear path_to_tdms_files i j l fit_x fit_real fit_imag Est lorentz_param;
disp("[Finished Script]")
