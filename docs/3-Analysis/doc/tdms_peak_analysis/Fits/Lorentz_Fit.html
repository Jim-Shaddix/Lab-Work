<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Lorentz_Fit</title>
  <meta name="keywords" content="Lorentz_Fit">
  <meta name="description" content="This function fits a complex lorentzian function to all of the peaks">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html tdms_peak_analysis --><!-- menu.html Fits -->
<h1>Lorentz_Fit
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This function fits a complex lorentzian function to all of the peaks</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function fit = Lorentz_Fit(cell_x_cor_fit, cell_y_cor_fit, cell_guess, fit_options) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> This function fits a complex lorentzian function to all of the peaks 
 in a given dataset, returns the arrays of the fit parameters found, and
 coordinates associated with the applied fit function.

 PARAMETERS:
 cell_x_cor_fit: [Cell Array] each cell contains:
                 The x-coordinates to perform the fit on.

 cell_y_cor_fit: [Cell Array] each cell contains:
                 The y-coordinates to perform the fit on.

 cell_guess:     [Cell Array] each cell contains:
                 An ititial guess for fit perameters
 RETURNS:
 1. [cell]: each cell contains:
            a struct describing the fit performed</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="Lorentz_Fit_File.html" class="code" title="function cell_peak_data = Lorentz_Fit_File(cell_x_cor_all, cell_real_cor_all, cell_imag_cor_all, cell_peak_data, cell_fit_options, given_bool)">Lorentz_Fit_File</a>	Lorentz_ Fit_File.m Fits a complex lorentzian function to all of the peaks</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function fit = Lorentz_Fit(cell_x_cor_fit, cell_y_cor_fit, cell_guess, fit_options)</a>
0002 <span class="comment">% This function fits a complex lorentzian function to all of the peaks</span>
0003 <span class="comment">% in a given dataset, returns the arrays of the fit parameters found, and</span>
0004 <span class="comment">% coordinates associated with the applied fit function.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% PARAMETERS:</span>
0007 <span class="comment">% cell_x_cor_fit: [Cell Array] each cell contains:</span>
0008 <span class="comment">%                 The x-coordinates to perform the fit on.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% cell_y_cor_fit: [Cell Array] each cell contains:</span>
0011 <span class="comment">%                 The y-coordinates to perform the fit on.</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% cell_guess:     [Cell Array] each cell contains:</span>
0014 <span class="comment">%                 An ititial guess for fit perameters</span>
0015 <span class="comment">% RETURNS:</span>
0016 <span class="comment">% 1. [cell]: each cell contains:</span>
0017 <span class="comment">%            a struct describing the fit performed</span>
0018 
0019     <span class="comment">% function handle for: [complex lorentzian]</span>
0020     <span class="comment">% x = [A, theta, gamma, f_0, offset_real, offset_imag]</span>
0021     <span class="comment">%lorentz_fnc = @(x, x_cor_fit) x(1) .* exp(1i .* x(2)) ./ ...</span>
0022     <span class="comment">%                           (x_cor_fit(1,:) - x(4) + 1i .* x(3)) + x(5);</span>
0023     
0024     model = @(x, x_cor_fit) <span class="keyword">...</span><span class="comment"> </span>
0025       x(1) ./ ((x_cor_fit(1,:) - x(4)).^2+x(3).^2) .* <span class="keyword">...</span>
0026         ((x_cor_fit(1,:) - x(4)).*cos(x(2)) + x(3).*sin(x(2))) + x(5) + <span class="keyword">...</span>
0027         <span class="keyword">...</span>
0028 1i * (x(1) ./ ((x_cor_fit(1,:) - x(4)).^2+x(3).^2) .* <span class="keyword">...</span>
0029         ((x_cor_fit(1,:) - x(4)).*sin(x(2)) - x(3).*cos(x(2))) + x(6));
0030     
0031     <span class="comment">%model = @(x, x_cor_fit) ...</span>
0032         
0033     
0034     lorentz_fnc=@(x, x_cor_fit) [real(model(x, x_cor_fit)); imag(model(x, x_cor_fit))]; 
0035         
0036     <span class="comment">% instantiate struct to return</span>
0037     <span class="comment">%fit = cell(1,length(cell_x_cor_fit));</span>
0038                         
0039     <span class="keyword">for</span> i = 1:length(cell_x_cor_fit)
0040         
0041         <span class="comment">% easier access to data</span>
0042         x_cor_fit = cell_x_cor_fit{i};
0043         y_cor_fit = cell_y_cor_fit{i};
0044         guess     = cell_guess{i};
0045         
0046         <span class="comment">% Perform Fit:</span>
0047         <span class="comment">%   xEst:     fit parameters (Array of Floats)</span>
0048         <span class="comment">%   resnorm:  sum of the squared residuals (Float)</span>
0049         <span class="comment">%   residual: (Array of Floats)</span>
0050         <span class="comment">%   exitFlag: [1] -&gt; function converged</span>
0051         <span class="comment">%             [2] -&gt; change x &lt; tolerance</span>
0052         <span class="comment">%             [3] -&gt; change residual &lt; tolerance</span>
0053         
0054         <span class="comment">% x = [A, theta, gamma, f_0, offset]</span>
0055         [Est, resnorm, residual, exitFlag, ouput, lambda, jacobian] = <span class="keyword">...</span>
0056                         lsqcurvefit( <span class="keyword">...</span><span class="comment"> </span>
0057                                      lorentz_fnc, guess,   <span class="keyword">...</span>
0058                                      x_cor_fit,            <span class="keyword">...</span>
0059                                      [real(y_cor_fit);imag(y_cor_fit)], <span class="keyword">...</span><span class="comment"> </span>
0060                                      [-inf,-inf,0,-inf,-inf,-inf], <span class="keyword">...</span>
0061                                      [],fit_options);  
0062         <span class="comment">% Error Values</span>
0063         ci = nlparci(Est,residual,<span class="string">'jacobian'</span>,jacobian);
0064         
0065         <span class="comment">% GET: Y-coordinates from fit</span>
0066         fit_curve = lorentz_fnc(Est,x_cor_fit);
0067 
0068         <span class="comment">% SET: fit signal</span>
0069         fit(i).frequencies = x_cor_fit;
0070         fit(i).signal_x    = fit_curve(1,:);
0071         fit(i).signal_y    = fit_curve(2,:);
0072 
0073         <span class="comment">% SET: fit parameters</span>
0074         fit(i).A        = Est(1);
0075         fit(i).theta    = Est(2);
0076         fit(i).gamma    = Est(3);
0077         fit(i).f_0      = Est(4);
0078         fit(i).x_offset = Est(5);
0079         fit(i).y_offset = Est(6);
0080         
0081         <span class="comment">% SET: fit parameter errors (95% confidence)</span>
0082         <span class="comment">%matrix_errors = [ci{:}];</span>
0083         <span class="comment">%matrix_errors = matrix_errors</span>
0084         <span class="comment">%params = {'A','theta','gamma','f_0','x_offset','y_offset'};</span>
0085         <span class="comment">%for j = 1:length(params)</span>
0086         <span class="comment">%   fit(i).([params{j},'_err']) = abs(ci(j,:)-Est(j));</span>
0087         <span class="comment">%end</span>
0088         
0089         fit(i).A_err        = (ci(1,2) - ci(1,1))/2;
0090         fit(i).theta_err    = (ci(2,2) - ci(2,1))/2;
0091         fit(i).gamma_err    = (ci(3,2) - ci(3,1))/2;
0092         fit(i).f_0_err      = (ci(4,2) - ci(4,1))/2;
0093         fit(i).x_offset_err = (ci(5,2) - ci(5,1))/2;
0094         fit(i).y_offset_err = (ci(6,2) - ci(6,1))/2;
0095         fit(i).ci = ci;
0096         
0097 <span class="comment">%         fit(i).A_err        = (ci(1,2) - ci(1,1))/2;</span>
0098 <span class="comment">%         fit(i).theta_err    = (ci(2,2) - ci(2,1))/2;</span>
0099 <span class="comment">%         fit(i).gamma_err    = (ci(3,2) - ci(3,1))/2;</span>
0100 <span class="comment">%         fit(i).f_0_err      = (ci(4,2) - ci(4,1))/2;</span>
0101 <span class="comment">%         fit(i).x_offset_err = (ci(5,2) - ci(5,1))/2;</span>
0102 <span class="comment">%         fit(i).y_offset_err = (ci(6,2) - ci(6,1))/2;</span>
0103 
0104     <span class="keyword">end</span>
0105 
0106 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 19-Aug-2018 19:01:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>