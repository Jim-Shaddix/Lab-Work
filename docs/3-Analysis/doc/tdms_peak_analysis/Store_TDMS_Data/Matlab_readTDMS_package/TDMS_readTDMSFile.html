<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of TDMS_readTDMSFile</title>
  <meta name="keywords" content="TDMS_readTDMSFile">
  <meta name="description" content="TDMS_readTDMSFile  Reads TDMS file and does minimal processing to obtain output">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html tdms_peak_analysis --><!-- ../menu.html Store_TDMS_Data --><!-- menu.html Matlab_readTDMS_package -->
<h1>TDMS_readTDMSFile
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>TDMS_readTDMSFile  Reads TDMS file and does minimal processing to obtain output</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [finalOutput,metaStruct] = TDMS_readTDMSFile(tdmsFileName,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">TDMS_readTDMSFile  Reads TDMS file and does minimal processing to obtain output

   [finalOutput,metaStruct] = TDMS_readTDMSFile(tdmsFileName)

   [...] = TDMS_readTDMSFile(tdmsFileName,'Property1',PropertyValue1,...)
   allows for specification of additional properties.

   [...] = TDMS_readTDMSFile(tdmsIndexFileName,...)  Allows you to pass 
   in the tdms_index file for debugging

   This is the main file for reading TDMS files.  It reads the file and
   does minimal processing on the output.  

   For wrappers of this function (RECOMMENDED):
   See Also:
       <a href="TDMS_getStruct.html" class="code" title="function [output,metaStruct] = TDMS_getStruct(filePath,structVersion,readOptions,structConvOptions)">TDMS_getStruct</a>
       <a href="TDMS_dataToGroupChanStruct_v1.html" class="code" title="function output = TDMS_dataToGroupChanStruct_v1(inputStruct,varargin)">TDMS_dataToGroupChanStruct_v1</a>,
       <a href="TDMS_dataToGroupChanStruct_v2.html" class="code" title="function [outputStruct,navigator] = TDMS_dataToGroupChanStruct_v2(inputStruct,varargin)">TDMS_dataToGroupChanStruct_v2</a>,
       <a href="TDMS_dataToGroupChanStruct_v3.html" class="code" title="function output = TDMS_dataToGroupChanStruct_v3(inputStruct,varargin)">TDMS_dataToGroupChanStruct_v3</a>,
       <a href="TDMS_dataToGroupChanStruct_v4.html" class="code" title="function output = TDMS_dataToGroupChanStruct_v4(inputStruct,varargin)">TDMS_dataToGroupChanStruct_v4</a>
       <a href="TDMS_readChannelOrGroup.html" class="code" title="function [channelData,channelNames] = TDMS_readChannelOrGroup(TDMS_filename,group,channel,subset)">TDMS_readChannelOrGroup</a>

   RETRIEVING PARTIAL DATA
   =======================================================================
   This code has the ability to retrieve a subset of the data from the
   tdms file.  For documentation on this see: TDMS_retrievingSubsets

   OUTPUTS:
   NOTE: Wrappers exist to change this to a preferred format.  See above.
   =======================================================================
   finalOutput : (struct)
   ---------------------------------
       .rootIndex    - index of the root
         .groupIndices - (numeric array) indices of all group objects
          .chanIndices  - (cell array of numeric arrays)
                       ex. {[1 2]   [3 4 5]   [6 7 8]}
                       Each index in the cell array corresponds to the
                       same index in groupNames and groupIndices
                       At that index is an array of indices for the
                       channel objects that belong to that group
          .chanNames    - (cell array of cell array of strings)
                       ex. {{'1' '2'} {'3' '4' '5'}}
                       similar setup to chanIndices
         .groupNames   - (cell array of strings) names of each group object

           For the following properties, the indices referred to above ,
           groupIndices and chanIndices, index into these arrays:
          .data         - (cell array, # elements = # objects)
         .propNames    - (cell array of cell arrays)
       .propValues   - (cell arrays of cell arrays)
       .dataType     - (num. array) Labview dataType enumeration
       .dataTypeName - (cell array of strings)
       .objectPathsOrig - (cell array of strings) This is thrown in for
                          reference and is the full name of the object as
                          tracked in the TDMS file
       .numberDataPointsRaw - The # of data points for each object that
                              are available in the TDMS file. This is not
                              filtered, thus it may not match the # of
                              data points returned in .data

   metaStruct : (struct)
   ---------------------------------
       This output is essentially a dumping ground for a lot of the
   temporary variables in the code and may change between versions.
       .version   - indicates which version of the code was used
                    to create this structure
       .fileName  - relative name (no path) of the tdms file on which
                    this structure is based
       .numberDataPoints - # of data points availabe for each channel
       .chanNames - channel name for each object, empty for channels &amp;
                    root
       .groupNames - group name for each object
   OTHER VARIABLES IN metaStruct MAY CHANGE ...


   OPTIONAL PARAMETERS: pass in as property/value pairs, case insensitive
   =======================================================================
   UTC_DIFF        : (default -5) Conversion of UTC Timestamp to local
                     time, if desired this can be set to 0 and no
                     conversion will occur

                     Eastern Time: -5, Central Time: -6

   USE_INDEX       : (default true) If true, reads the tdms_index file
                     if it is available.  This may offer some speedup in
                     reading the file.

   MAX_NUM_OBJECTS : (default 100) This is currently used in preallocation
                      of the # of objects.  On overflow the same # is used
                      to grow by, i.e. on object 101, grow to 200

   MAX_NUM_PROPS   = (default 20), used for initializing property cell
                      arrays for each object

   N_SEGS_GUESS    = (default 25000), estimated # of segments for
                      preallocation purposes

   N_SEGS_INC      = (default 25000), how much to expand upon segment
                      overflow, i.e. if more than N_SEGS_GUESS segments

   DATE_STR_FORMAT = (default 'dd-mmm-yyyy HH:MM:SS:FFF'), how to process
                     the timestamp properties, timestamp arrays (i.e.
                     data) are left in the same format as Matlab's now
                     command, i.e. a numeric value that you can call the
                     function datestr() on to return a value

   INIT_CHUNK_SIZE = (default 1000), the expected # of chunks of data,
                     this probably shouldn't be changed ...

   Additional properties are defined in TDMS_retrievingSubsets</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/tdmsSubfunctions/TDMS_getDataTypeName.html" class="code" title="function typeName = TDMS_getDataTypeName(dataType)">TDMS_getDataTypeName</a>	TDMS_getDataTypeName  Returns a string indicating dataType</li><li><a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/tdmsSubfunctions/TDMS_getGroupChanNames.html" class="code" title="function metaStruct = TDMS_getGroupChanNames(metaStruct)">TDMS_getGroupChanNames</a>	TDMS_getGroupChanNames  Small function to get group/channel names from paths</li><li><a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/tdmsSubfunctions/TDMS_handleGetDataOption.html" class="code" title="function varargout = TDMS_handleGetDataOption(mode,optionsIn,metaStruct)">TDMS_handleGetDataOption</a>	TDMS_handleGetDataOption  Processes input options</li><li><a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/tdmsSubfunctions/TDMS_preprocessFile.html" class="code" title="function metaStruct = TDMS_preprocessFile(fid,tdmsFileName,params)">TDMS_preprocessFile</a>	TDMS_preprocessFile  Populates props and gets segment information</li><li><a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/tdmsSubfunctions/TDMS_readFileHelper_v1.html" class="code" title="function data = TDMS_readFileHelper_v1(fid,optionStruct,metaStruct,paramsStruct)">TDMS_readFileHelper_v1</a>	TDMS_readFileHelper_v1</li><li><a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/tdmsSubfunctions/TDMS_readFileHelper_v2.html" class="code" title="function data = TDMS_readFileHelper_v2(fid,optionStruct,metaStruct,paramsStruct)">TDMS_readFileHelper_v2</a>	TDMS_readFileHelper_v2</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="TDMS_getStruct.html" class="code" title="function [output,metaStruct] = TDMS_getStruct(filePath,structVersion,readOptions,structConvOptions)">TDMS_getStruct</a>	TDMS_getStruct  A wrapper for simplifying data retrieval from TDMS_readTDMSFile</li><li><a href="TDMS_readChannelOrGroup.html" class="code" title="function [channelData,channelNames] = TDMS_readChannelOrGroup(TDMS_filename,group,channel,subset)">TDMS_readChannelOrGroup</a>	TDMS_readChannelOrGroup  Return data from a specific channel or group of channels</li><li><a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/private/TDMS_exampleFunctionCalls.html" class="code" title="">TDMS_exampleFunctionCalls</a>	The following is some example code of calls that can be made</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [finalOutput,metaStruct] = TDMS_readTDMSFile(tdmsFileName,varargin)</a>
0002 <span class="comment">%TDMS_readTDMSFile  Reads TDMS file and does minimal processing to obtain output</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   [finalOutput,metaStruct] = TDMS_readTDMSFile(tdmsFileName)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%   [...] = TDMS_readTDMSFile(tdmsFileName,'Property1',PropertyValue1,...)</span>
0007 <span class="comment">%   allows for specification of additional properties.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%   [...] = TDMS_readTDMSFile(tdmsIndexFileName,...)  Allows you to pass</span>
0010 <span class="comment">%   in the tdms_index file for debugging</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%   This is the main file for reading TDMS files.  It reads the file and</span>
0013 <span class="comment">%   does minimal processing on the output.</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%   For wrappers of this function (RECOMMENDED):</span>
0016 <span class="comment">%   See Also:</span>
0017 <span class="comment">%       TDMS_getStruct</span>
0018 <span class="comment">%       TDMS_dataToGroupChanStruct_v1,</span>
0019 <span class="comment">%       TDMS_dataToGroupChanStruct_v2,</span>
0020 <span class="comment">%       TDMS_dataToGroupChanStruct_v3,</span>
0021 <span class="comment">%       TDMS_dataToGroupChanStruct_v4</span>
0022 <span class="comment">%       TDMS_readChannelOrGroup</span>
0023 <span class="comment">%</span>
0024 <span class="comment">%   RETRIEVING PARTIAL DATA</span>
0025 <span class="comment">%   =======================================================================</span>
0026 <span class="comment">%   This code has the ability to retrieve a subset of the data from the</span>
0027 <span class="comment">%   tdms file.  For documentation on this see: TDMS_retrievingSubsets</span>
0028 <span class="comment">%</span>
0029 <span class="comment">%   OUTPUTS:</span>
0030 <span class="comment">%   NOTE: Wrappers exist to change this to a preferred format.  See above.</span>
0031 <span class="comment">%   =======================================================================</span>
0032 <span class="comment">%   finalOutput : (struct)</span>
0033 <span class="comment">%   ---------------------------------</span>
0034 <span class="comment">%       .rootIndex    - index of the root</span>
0035 <span class="comment">%         .groupIndices - (numeric array) indices of all group objects</span>
0036 <span class="comment">%          .chanIndices  - (cell array of numeric arrays)</span>
0037 <span class="comment">%                       ex. {[1 2]   [3 4 5]   [6 7 8]}</span>
0038 <span class="comment">%                       Each index in the cell array corresponds to the</span>
0039 <span class="comment">%                       same index in groupNames and groupIndices</span>
0040 <span class="comment">%                       At that index is an array of indices for the</span>
0041 <span class="comment">%                       channel objects that belong to that group</span>
0042 <span class="comment">%          .chanNames    - (cell array of cell array of strings)</span>
0043 <span class="comment">%                       ex. {{'1' '2'} {'3' '4' '5'}}</span>
0044 <span class="comment">%                       similar setup to chanIndices</span>
0045 <span class="comment">%         .groupNames   - (cell array of strings) names of each group object</span>
0046 <span class="comment">%</span>
0047 <span class="comment">%           For the following properties, the indices referred to above ,</span>
0048 <span class="comment">%           groupIndices and chanIndices, index into these arrays:</span>
0049 <span class="comment">%          .data         - (cell array, # elements = # objects)</span>
0050 <span class="comment">%         .propNames    - (cell array of cell arrays)</span>
0051 <span class="comment">%       .propValues   - (cell arrays of cell arrays)</span>
0052 <span class="comment">%       .dataType     - (num. array) Labview dataType enumeration</span>
0053 <span class="comment">%       .dataTypeName - (cell array of strings)</span>
0054 <span class="comment">%       .objectPathsOrig - (cell array of strings) This is thrown in for</span>
0055 <span class="comment">%                          reference and is the full name of the object as</span>
0056 <span class="comment">%                          tracked in the TDMS file</span>
0057 <span class="comment">%       .numberDataPointsRaw - The # of data points for each object that</span>
0058 <span class="comment">%                              are available in the TDMS file. This is not</span>
0059 <span class="comment">%                              filtered, thus it may not match the # of</span>
0060 <span class="comment">%                              data points returned in .data</span>
0061 <span class="comment">%</span>
0062 <span class="comment">%   metaStruct : (struct)</span>
0063 <span class="comment">%   ---------------------------------</span>
0064 <span class="comment">%       This output is essentially a dumping ground for a lot of the</span>
0065 <span class="comment">%   temporary variables in the code and may change between versions.</span>
0066 <span class="comment">%       .version   - indicates which version of the code was used</span>
0067 <span class="comment">%                    to create this structure</span>
0068 <span class="comment">%       .fileName  - relative name (no path) of the tdms file on which</span>
0069 <span class="comment">%                    this structure is based</span>
0070 <span class="comment">%       .numberDataPoints - # of data points availabe for each channel</span>
0071 <span class="comment">%       .chanNames - channel name for each object, empty for channels &amp;</span>
0072 <span class="comment">%                    root</span>
0073 <span class="comment">%       .groupNames - group name for each object</span>
0074 <span class="comment">%   OTHER VARIABLES IN metaStruct MAY CHANGE ...</span>
0075 <span class="comment">%</span>
0076 <span class="comment">%</span>
0077 <span class="comment">%   OPTIONAL PARAMETERS: pass in as property/value pairs, case insensitive</span>
0078 <span class="comment">%   =======================================================================</span>
0079 <span class="comment">%   UTC_DIFF        : (default -5) Conversion of UTC Timestamp to local</span>
0080 <span class="comment">%                     time, if desired this can be set to 0 and no</span>
0081 <span class="comment">%                     conversion will occur</span>
0082 <span class="comment">%</span>
0083 <span class="comment">%                     Eastern Time: -5, Central Time: -6</span>
0084 <span class="comment">%</span>
0085 <span class="comment">%   USE_INDEX       : (default true) If true, reads the tdms_index file</span>
0086 <span class="comment">%                     if it is available.  This may offer some speedup in</span>
0087 <span class="comment">%                     reading the file.</span>
0088 <span class="comment">%</span>
0089 <span class="comment">%   MAX_NUM_OBJECTS : (default 100) This is currently used in preallocation</span>
0090 <span class="comment">%                      of the # of objects.  On overflow the same # is used</span>
0091 <span class="comment">%                      to grow by, i.e. on object 101, grow to 200</span>
0092 <span class="comment">%</span>
0093 <span class="comment">%   MAX_NUM_PROPS   = (default 20), used for initializing property cell</span>
0094 <span class="comment">%                      arrays for each object</span>
0095 <span class="comment">%</span>
0096 <span class="comment">%   N_SEGS_GUESS    = (default 25000), estimated # of segments for</span>
0097 <span class="comment">%                      preallocation purposes</span>
0098 <span class="comment">%</span>
0099 <span class="comment">%   N_SEGS_INC      = (default 25000), how much to expand upon segment</span>
0100 <span class="comment">%                      overflow, i.e. if more than N_SEGS_GUESS segments</span>
0101 <span class="comment">%</span>
0102 <span class="comment">%   DATE_STR_FORMAT = (default 'dd-mmm-yyyy HH:MM:SS:FFF'), how to process</span>
0103 <span class="comment">%                     the timestamp properties, timestamp arrays (i.e.</span>
0104 <span class="comment">%                     data) are left in the same format as Matlab's now</span>
0105 <span class="comment">%                     command, i.e. a numeric value that you can call the</span>
0106 <span class="comment">%                     function datestr() on to return a value</span>
0107 <span class="comment">%</span>
0108 <span class="comment">%   INIT_CHUNK_SIZE = (default 1000), the expected # of chunks of data,</span>
0109 <span class="comment">%                     this probably shouldn't be changed ...</span>
0110 <span class="comment">%</span>
0111 <span class="comment">%   Additional properties are defined in TDMS_retrievingSubsets</span>
0112 
0113 
0114 
0115 <span class="comment">%FUNCTIONS CALLED IN THIS FILE:</span>
0116 <span class="comment">%==============================================</span>
0117 <span class="comment">%       TDMS_handleGetDataOption</span>
0118 <span class="comment">%       TDMS_preprocessFile</span>
0119 <span class="comment">%       TDMS_getGroupChanNames</span>
0120 <span class="comment">%       TDMS_processLeadIn</span>
0121 <span class="comment">%       TDMS_readFileHelper_v2</span>
0122 <span class="comment">%       TDMS_readFileHelper_v1</span>
0123 
0124 
0125 <span class="keyword">if</span> nargin == 0
0126     error(<span class="string">'Input to %s requires a filename'</span>,mfilename)
0127 <span class="keyword">end</span>
0128 
0129 <span class="keyword">if</span> ~exist(tdmsFileName,<span class="string">'file'</span>)
0130     error(<span class="string">'The file specified for tdms reading doesn''t exist, FILENAME: %s'</span>,tdmsFileName)
0131 <span class="keyword">end</span>
0132 
0133 <span class="comment">%Added to allow for tdms_index reading</span>
0134 [~,~,fileExt] = fileparts(tdmsFileName);
0135 
0136 <span class="comment">%DON'T CHANGE ME</span>
0137 <span class="comment">%===========================================</span>
0138 temp = [who; {<span class="string">'temp'</span>}];
0139 STRING_ENCODING = <span class="string">'UTF-8'</span>;
0140 SECONDS_IN_DAY  = 86400;  <span class="comment">%60s * 60 min * 24 hours</span>
0141 CONV_FACTOR     = 695422; <span class="comment">%datenum('01-Jan-1904')</span>
0142 ROOT_PATH       = <span class="string">'/'</span>;
0143 ROOT_GROUP_NAME = <span class="string">''</span>;
0144 TDMS_INDEX_EXT  = <span class="string">'.tdms_index'</span>;
0145 MACHINE_FORMAT  = <span class="string">'ieee-le'</span>; <span class="comment">%NOTE: Eventually this could be passed into</span>
0146 <span class="comment">%fread for support of different endianess</span>
0147 CURRENT_VERSION = 2.5;
0148 constantParams = setdiff(who,temp);  <span class="comment">%NOTE: Below I place these into the</span>
0149 <span class="comment">%constants variable structure but I don't allow assignment from inputs</span>
0150 
0151 
0152 <span class="comment">%PROPERTIES THAT MIGHT NEED TO BE CHANGED</span>
0153 <span class="comment">%==========================================================================</span>
0154 temp = [who; {<span class="string">'temp'</span>}];
0155 <span class="comment">%The following get passed down into TDMS_preprocessFile</span>
0156 UTC_DIFF        = -5;   <span class="comment">%#ok&lt;*NASGU&gt; %This will report times in Eastern Standard Time</span>
0157 USE_INDEX       = true; <span class="comment">%Parse meta data from index if present</span>
0158 MAX_NUM_OBJECTS = 100;  <span class="comment">%Best guess as to max # of objects ever encountered</span>
0159 MAX_NUM_PROPS   = 20;   <span class="comment">%&quot;                        &quot; properties &quot;          &quot;</span>
0160 N_SEGS_GUESS    = 25000;<span class="comment">%same, but for segments</span>
0161 N_SEGS_INC      = 25000;<span class="comment">%if off, how large to grow estimate by when resizing</span>
0162 DATE_STR_FORMAT = <span class="string">'dd-mmm-yyyy HH:MM:SS:FFF'</span>; <span class="comment">%default conversion of property value</span>
0163                   <span class="comment">%NOTE: data values are not converted, but run datestr()</span>
0164                   <span class="comment">%on them if you wish to see their value as a string</span>
0165 INIT_CHUNK_SIZE = 1000; <span class="comment">%a chunk is a subset of a segment, the # of chunks</span>
0166                         <span class="comment">%varies on an object by object basis, only applies</span>
0167                         <span class="comment">%to objects with raw data</span>
0168                                   
0169 DEBUG           = false; <span class="comment">%Internal use</span>
0170 
0171 <span class="comment">%NOTE: INDEX_DEBUG indicates that we'll only attempt to read the index</span>
0172 <span class="comment">%file, no raw data will be read</span>
0173 <span class="keyword">if</span> strcmp(fileExt,<span class="string">'.tdms_index'</span>)
0174     INDEX_DEBUG     = true;
0175 <span class="keyword">else</span>
0176     INDEX_DEBUG     = false;
0177 <span class="keyword">end</span>
0178 
0179 OBJECTS_GET      = struct([]);
0180 OBJECTS_IGNORE   = struct([]);
0181 SUBSET_GET       = [];
0182 GET_INDICES      = [];  <span class="comment">%Needs fields 'group' 'channel' 'indices'</span>
0183 SUBSET_IS_LENGTH = true;
0184 GET_DATA_OPTION  = <span class="string">'getAll'</span>;
0185 META_STRUCT      = []; <span class="comment">%Can be used to reduce processing time</span>
0186                       <span class="comment">%This is an output from this file</span>
0187 defaultOPTS  = setdiff(who,temp);  <span class="comment">%Anything in defaultOPTS can be overwritten</span>
0188 <span class="comment">%below if the name matches a property name from the input</span>
0189 
0190 <span class="comment">%Assigment of default values, as well as paramsStruct population</span>
0191 <span class="comment">%--------------------------------------------------------------------------</span>
0192 paramsStruct = struct;
0193 <span class="keyword">if</span> nargin &gt; 1
0194     defNames = varargin(1:2:end);
0195 <span class="keyword">else</span>
0196     defNames = {};
0197 <span class="keyword">end</span>
0198 
0199 <span class="keyword">for</span> iDefault = 1:length(defaultOPTS)
0200     curVariable = defaultOPTS{iDefault};
0201     I = find(strcmpi(curVariable,defNames),1);
0202     <span class="keyword">if</span> ~isempty(I)
0203         eval([curVariable <span class="string">'= varargin{2*I};'</span>])
0204     <span class="keyword">end</span>
0205     paramsStruct.(curVariable) = eval(curVariable);
0206 <span class="keyword">end</span>
0207 
0208 <span class="keyword">for</span> iConst = 1:length(constantParams)
0209     curVariable = constantParams{iConst};
0210     paramsStruct.(curVariable) = eval(curVariable);
0211 <span class="keyword">end</span>
0212 <span class="comment">%paramsStruct now contains all constants, as well as their values</span>
0213 
0214 <span class="comment">%Data option checking</span>
0215 <span class="comment">%--------------------------------------------------------------------------</span>
0216 <a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/tdmsSubfunctions/TDMS_handleGetDataOption.html" class="code" title="function varargout = TDMS_handleGetDataOption(mode,optionsIn,metaStruct)">TDMS_handleGetDataOption</a>(<span class="string">'check'</span>,paramsStruct)
0217 
0218 <span class="comment">%File Opening &amp; meta data processing</span>
0219 <span class="comment">%--------------------------------------------------------------------------</span>
0220 <span class="keyword">if</span> ~INDEX_DEBUG
0221     fid = fopen(tdmsFileName,<span class="string">'r'</span>,MACHINE_FORMAT,STRING_ENCODING);
0222 <span class="keyword">else</span>
0223     fid = []; <span class="comment">%Don't open the .tdms file, .tdms_index only</span>
0224 <span class="keyword">end</span>
0225 
0226 metaStruct   = <a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/tdmsSubfunctions/TDMS_preprocessFile.html" class="code" title="function metaStruct = TDMS_preprocessFile(fid,tdmsFileName,params)">TDMS_preprocessFile</a>(fid,tdmsFileName,paramsStruct);
0227 metaStruct   = <a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/tdmsSubfunctions/TDMS_getGroupChanNames.html" class="code" title="function metaStruct = TDMS_getGroupChanNames(metaStruct)">TDMS_getGroupChanNames</a>(metaStruct); <span class="comment">%Processing of channel &amp; group names</span>
0228 optionStruct = <a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/tdmsSubfunctions/TDMS_handleGetDataOption.html" class="code" title="function varargout = TDMS_handleGetDataOption(mode,optionsIn,metaStruct)">TDMS_handleGetDataOption</a>(<span class="string">'getArray'</span>,paramsStruct,metaStruct); <span class="comment">%Option handling</span>
0229 
0230 
0231 <span class="comment">%Propery handling</span>
0232 <span class="comment">%--------------------------------------------------------------------------</span>
0233 rawDataInfo = metaStruct.rawDataInfo;
0234 numObjects  = length(rawDataInfo);
0235 propNames   = cell(1,numObjects);
0236 propValues  = cell(1,numObjects);
0237 <span class="keyword">for</span> iObject = 1:numObjects
0238     propNames{iObject}  = rawDataInfo(iObject).propNames;
0239     propValues{iObject} = rawDataInfo(iObject).propValues;
0240 <span class="keyword">end</span>
0241 
0242 <span class="comment">%Getting the data</span>
0243 <span class="comment">%--------------------------------------------------------------------------</span>
0244 <span class="keyword">if</span> strcmpi(GET_DATA_OPTION,<span class="string">'getNone'</span>) || INDEX_DEBUG
0245     data = cell(1,length(metaStruct.rawDataInfo));
0246     <span class="keyword">if</span> ~INDEX_DEBUG
0247         fclose(fid);
0248     <span class="keyword">end</span>
0249 <span class="keyword">elseif</span> optionStruct.useSubset
0250     data = <a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/tdmsSubfunctions/TDMS_readFileHelper_v2.html" class="code" title="function data = TDMS_readFileHelper_v2(fid,optionStruct,metaStruct,paramsStruct)">TDMS_readFileHelper_v2</a>(fid,optionStruct,metaStruct,paramsStruct);
0251 <span class="keyword">else</span>
0252     data = <a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/tdmsSubfunctions/TDMS_readFileHelper_v1.html" class="code" title="function data = TDMS_readFileHelper_v1(fid,optionStruct,metaStruct,paramsStruct)">TDMS_readFileHelper_v1</a>(fid,optionStruct,metaStruct,paramsStruct);
0253 <span class="keyword">end</span>
0254 
0255 <span class="comment">%INITIALIZATION OF GENERIC OUTPUT</span>
0256 <span class="comment">%==========================================================================</span>
0257 <span class="comment">%use groupInfo = TDMSp_getGroupInfo(groupNames,chanNames,isChan) instead</span>
0258 
0259 [uGroups,~,Igroup] = unique(metaStruct.groupNames);
0260 <span class="comment">%NOTE: Igroup tells us which of the unique group names each index belongs to</span>
0261 
0262 rootIndex = find(cellfun(@(x) strcmp(x,ROOT_PATH),metaStruct.objectNameList));
0263 
0264 groupIndices     = zeros(1,length(uGroups)-1);
0265 chanIndices      = cell(1,length(groupIndices));
0266 groupNamesOutput = cell(1,length(groupIndices));
0267 chanNamesOutput  = cell(1,length(groupIndices));
0268 
0269 curGroupCount = 0;
0270 <span class="keyword">for</span> iGroup = 1:length(uGroups)
0271     <span class="keyword">if</span> ~strcmp(uGroups(iGroup),ROOT_GROUP_NAME)
0272         curGroupCount = curGroupCount + 1;
0273         
0274         <span class="comment">%Find all those with matching group name</span>
0275         inGroup = find(Igroup == iGroup);
0276         
0277         <span class="comment">%Parse out the actual group object</span>
0278         isGroupObject = ~metaStruct.isChan(inGroup);
0279         I_groupObject = inGroup(isGroupObject);
0280         groupIndices(curGroupCount)     = I_groupObject;
0281         groupNamesOutput(curGroupCount) = uGroups(iGroup);
0282         
0283         <span class="comment">%Parse out the channels for that group</span>
0284         inGroup(isGroupObject)     = [];
0285         chanIndices{curGroupCount} = inGroup;
0286         chanNamesOutput{curGroupCount} = metaStruct.chanNames(inGroup);
0287     <span class="keyword">end</span>
0288 <span class="keyword">end</span>
0289 
0290 finalOutput = struct(<span class="keyword">...</span>
0291     <span class="string">'rootIndex'</span>,rootIndex,<span class="keyword">...</span>
0292     <span class="string">'groupIndices'</span>,groupIndices,<span class="keyword">...</span>
0293     <span class="string">'groupNames'</span>,{groupNamesOutput},<span class="keyword">...</span>
0294     <span class="string">'chanIndices'</span>,{chanIndices},<span class="keyword">...</span>
0295     <span class="string">'chanNames'</span>,{chanNamesOutput},<span class="keyword">...</span>
0296     <span class="string">'data'</span>,{data},<span class="keyword">...</span>
0297     <span class="string">'propNames'</span>,{propNames},<span class="keyword">...</span>
0298     <span class="string">'propValues'</span>,{propValues},<span class="keyword">...</span>
0299     <span class="string">'objectPathsOrig'</span>,{metaStruct.objectNameList},<span class="keyword">...</span>
0300     <span class="string">'numberDataPointsRaw'</span>,metaStruct.numberDataPoints,<span class="keyword">...</span>
0301     <span class="string">'dataType'</span>,[rawDataInfo.dataType],<span class="keyword">...</span>
0302     <span class="string">'dataTypeName'</span>,{arrayfun(@<a href="../../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/tdmsSubfunctions/TDMS_getDataTypeName.html" class="code" title="function typeName = TDMS_getDataTypeName(dataType)">TDMS_getDataTypeName</a>,[rawDataInfo.dataType],<span class="string">'UniformOutput'</span>,false)});
0303 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 19-Aug-2018 19:01:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>