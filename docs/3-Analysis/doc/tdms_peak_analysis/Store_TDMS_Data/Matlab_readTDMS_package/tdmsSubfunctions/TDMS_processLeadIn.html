<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of TDMS_processLeadIn</title>
  <meta name="keywords" content="TDMS_processLeadIn">
  <meta name="description" content="TDMS_processLeadIn  Reads the &quot;Lead In&quot; portion of the data segment">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../../menu.html tdms_peak_analysis --><!-- ../../menu.html Store_TDMS_Data --><!-- ../menu.html Matlab_readTDMS_package --><!-- menu.html tdmsSubfunctions -->
<h1>TDMS_processLeadIn
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>TDMS_processLeadIn  Reads the &quot;Lead In&quot; portion of the data segment</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function [flags,info,eof_error] = TDMS_processLeadIn(fid,lastLetter) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">TDMS_processLeadIn  Reads the &quot;Lead In&quot; portion of the data segment

   [flags,info] = TDMS_processLeadIn(fid)

   OUTPUTS
   ===============================
   flags (struct)  :
           .hasMetaData    - true if segment has meta data
           .kTocNewObjList - true if there is a new object order for raw data
           .hasRawData     - true if segment has raw data
           .isInterleaved  - true if raw data is interleaved
           .isBigEndian    - true if bigEndian
           .hasRawDaqMX    - true if DaqMX raw data is present
   info (struct)   :
           .verNumber   - ill defined, current versions should have no
                          impact on the ability to read the file according
                          to current specifications (Jan 2010), i.e. no
                          processing change is needed if the version is one 
                          or the other
           .segLength   - length to the next segment in bytes (after lead in)
           .metaLength  - length of meta data in bytes</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="TDMS_preprocessFile.html" class="code" title="function metaStruct = TDMS_preprocessFile(fid,tdmsFileName,params)">TDMS_preprocessFile</a>	TDMS_preprocessFile  Populates props and gets segment information</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [flags,info,eof_error] = TDMS_processLeadIn(fid,lastLetter)</a>
0002 <span class="comment">%TDMS_processLeadIn  Reads the &quot;Lead In&quot; portion of the data segment</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   [flags,info] = TDMS_processLeadIn(fid)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%   OUTPUTS</span>
0007 <span class="comment">%   ===============================</span>
0008 <span class="comment">%   flags (struct)  :</span>
0009 <span class="comment">%           .hasMetaData    - true if segment has meta data</span>
0010 <span class="comment">%           .kTocNewObjList - true if there is a new object order for raw data</span>
0011 <span class="comment">%           .hasRawData     - true if segment has raw data</span>
0012 <span class="comment">%           .isInterleaved  - true if raw data is interleaved</span>
0013 <span class="comment">%           .isBigEndian    - true if bigEndian</span>
0014 <span class="comment">%           .hasRawDaqMX    - true if DaqMX raw data is present</span>
0015 <span class="comment">%   info (struct)   :</span>
0016 <span class="comment">%           .verNumber   - ill defined, current versions should have no</span>
0017 <span class="comment">%                          impact on the ability to read the file according</span>
0018 <span class="comment">%                          to current specifications (Jan 2010), i.e. no</span>
0019 <span class="comment">%                          processing change is needed if the version is one</span>
0020 <span class="comment">%                          or the other</span>
0021 <span class="comment">%           .segLength   - length to the next segment in bytes (after lead in)</span>
0022 <span class="comment">%           .metaLength  - length of meta data in bytes</span>
0023 
0024     <span class="comment">%LEAD IN PROCESSING</span>
0025     <span class="comment">%================================================</span>
0026     <span class="comment">%1) TDSm - (indicats lead in)</span>
0027     Ttag = fread(fid,1,<span class="string">'uint8'</span>);
0028     Dtag = fread(fid,1,<span class="string">'uint8'</span>);
0029     Stag = fread(fid,1,<span class="string">'uint8'</span>);
0030     mtag = fread(fid,1,<span class="string">'uint8'</span>);
0031 
0032     <span class="keyword">if</span> ~(Ttag == 84 &amp;&amp; Dtag == 68 &amp;&amp; Stag == 83 &amp;&amp; mtag == lastLetter)
0033         error(<span class="string">'Unexpected lead in header'</span>)
0034     <span class="keyword">else</span>
0035         <span class="comment">%2) Kind of Data</span>
0036         tocMask = fread(fid,1,<span class="string">'uint32'</span>);    
0037         flags = struct(<span class="keyword">...</span>
0038             <span class="string">'hasMetaData'</span>,      bitget(tocMask,2),<span class="keyword">...</span>
0039             <span class="string">'kTocNewObjList'</span>,   bitget(tocMask,3),<span class="keyword">...</span>
0040             <span class="string">'hasRawData'</span>,       bitget(tocMask,4),<span class="keyword">...</span>
0041             <span class="string">'isInterleaved'</span>,    bitget(tocMask,6),<span class="keyword">...</span><span class="comment"> %false, contiguous</span>
0042             <span class="string">'isBigEndian'</span>,      bitget(tocMask,7),<span class="keyword">...</span><span class="comment"> %false, little-endian</span>
0043             <span class="string">'hasRawDaqMX'</span>,      bitget(tocMask,8));
0044         
0045         <span class="keyword">if</span> flags.isBigEndian
0046             error(<span class="string">'Currently code is unable to handle Big-Endian format'</span>)
0047         <span class="keyword">end</span>
0048         
0049         <span class="keyword">if</span> flags.hasRawDaqMX
0050             error(<span class="string">'Currently code is unable to ignore/handle Raw Daq MX data'</span>)
0051         <span class="keyword">end</span>
0052 
0053         <span class="comment">%3) Version Number</span>
0054         info = struct(<span class="keyword">...</span>
0055             <span class="string">'verNumber'</span>,  fread(fid,1,<span class="string">'uint32'</span>),<span class="keyword">...</span><span class="comment">  %This is not very well defined</span>
0056             <span class="string">'segLength'</span>,  fread(fid,1,<span class="string">'uint64'</span>),<span class="keyword">...</span>
0057             <span class="string">'metaLength'</span>, fread(fid,1,<span class="string">'uint64'</span>));  
0058     
0059     <span class="comment">%NOT THROWING THIS ERROR RIGHT NOW</span>
0060     <span class="comment">%======================================================================</span>
0061     <span class="comment">%This should really quit instead of throwing an error</span>
0062     eof_error = info.segLength == 2^64-1;
0063 <span class="comment">%         if info.segLength == 2^64-1</span>
0064 <span class="comment">%             error('File got corrupted when saving')</span>
0065 <span class="comment">%         end</span>
0066     
0067         <span class="comment">%This most likely suggests an error in the reading</span>
0068         <span class="keyword">if</span> ~eof_error &amp;&amp; flags.hasMetaData ~= (info.metaLength ~= 0)
0069             error(<span class="string">'Flags suggest presence of meta data but no meta is present according to length value'</span>)
0070         <span class="keyword">end</span>
0071     <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 19-Aug-2018 19:01:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>