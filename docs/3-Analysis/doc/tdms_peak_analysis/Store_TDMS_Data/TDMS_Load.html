<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of TDMS_Load</title>
  <meta name="keywords" content="TDMS_Load">
  <meta name="description" content="1. Reads directory (path_to_files) for filenames and">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html tdms_peak_analysis --><!-- menu.html Store_TDMS_Data -->
<h1>TDMS_Load
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>1. Reads directory (path_to_files) for filenames and</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function tdms_data=TDMS_Load(path_to_files) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> 1. Reads directory (path_to_files) for filenames and 
    loads all TDMS files into Cell Array. 
 2. Extracts Temperature from filename string by finding character 'K'.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="Get_RUS_Data_Struct.html" class="code" title="function  RUS_data = Get_RUS_Data_Struct(length)">Get_RUS_Data_Struct</a>	RETURNS: a structure that is used to store all of the data associated</li><li><a href="../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/TDMS_getStruct.html" class="code" title="function [output,metaStruct] = TDMS_getStruct(filePath,structVersion,readOptions,structConvOptions)">TDMS_getStruct</a>	TDMS_getStruct  A wrapper for simplifying data retrieval from TDMS_readTDMSFile</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../tdms_peak_analysis/Andrew_main.html" class="code" title="">Andrew_main</a>	% Load TMDS</li><li><a href="../../tdms_peak_analysis/main.html" class="code" title="">main</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function tdms_data=TDMS_Load(path_to_files)</a>
0002 <span class="comment">% 1. Reads directory (path_to_files) for filenames and</span>
0003 <span class="comment">%    loads all TDMS files into Cell Array.</span>
0004 <span class="comment">% 2. Extracts Temperature from filename string by finding character 'K'.</span>
0005 
0006     <span class="comment">% Store File Information ----------------------------------------------</span>
0007 
0008     <span class="comment">% UPDATE path_to_files</span>
0009     <span class="comment">% - this is done to accomodate the TDMS_getStruct function, that</span>
0010     <span class="comment">%   requires that the directory passed in ends with /.</span>
0011     path_to_files = char(path_to_files);
0012     <span class="keyword">if</span> path_to_files(end) ~= <span class="string">'/'</span>
0013         path_to_files(end+1) = <span class="string">'/'</span>;
0014     <span class="keyword">end</span>
0015 
0016     <span class="comment">% GET: structure that descibes the provided path</span>
0017     dir_struct      = dir(path_to_files);
0018     
0019     <span class="keyword">if</span> isempty(dir_struct)
0020         error([<span class="string">'The directory passed in could not be reached'</span>, <span class="keyword">...</span>
0021                <span class="string">' from current path.'</span>]);
0022     <span class="keyword">end</span>
0023     
0024     <span class="comment">% GET: file names ending with .tdms</span>
0025     file_names      = string({dir_struct.name});
0026     tdms_file_names = file_names(endsWith(file_names,<span class="string">'.tdms'</span>));
0027     
0028     <span class="comment">% CHECK: that tdms files were found</span>
0029     <span class="keyword">if</span> isempty(tdms_file_names)
0030         fprintf(<span class="string">'No tdms Files Were Found in the directory passed in:\n'</span>)
0031         fprintf([char(path_to_files),<span class="string">'\n\n'</span>])
0032         fprintf(<span class="string">'These are the files/directories that were found:\n'</span>);
0033         disp(file_names');
0034         error(<span class="string">'Failed to find tmds files in the provided path !!!'</span>);
0035     <span class="keyword">end</span>
0036     
0037     tdms_data = <a href="Get_RUS_Data_Struct.html" class="code" title="function  RUS_data = Get_RUS_Data_Struct(length)">Get_RUS_Data_Struct</a>(length(tdms_file_names));
0038     
0039     cell_tdms_file_names = num2cell(tdms_file_names);
0040     [tdms_data.file_name] = cell_tdms_file_names{:};
0041     
0042     <span class="keyword">for</span> i=1:length(tdms_file_names)
0043         <span class="comment">% Store Signal Information ----------------------------------------</span>
0044         
0045         <span class="comment">% STORE: tdms Data Struct</span>
0046         RUSdata = <a href="../../tdms_peak_analysis/Store_TDMS_Data/Matlab_readTDMS_package/TDMS_getStruct.html" class="code" title="function [output,metaStruct] = TDMS_getStruct(filePath,structVersion,readOptions,structConvOptions)">TDMS_getStruct</a>([path_to_files,tdms_file_names{i}]);
0047 
0048         <span class="comment">% GET/STORE: Temperature From File Name Using Regex</span>
0049         pattern = <span class="string">'\d{0,3}\.?\d+K'</span>;
0050         temperature_str = erase(regexp(tdms_file_names{i}, pattern, <span class="string">'match'</span>), <span class="string">'K'</span>);
0051         tdms_data(i).temperature     = str2double(temperature_str);
0052 
0053         <span class="comment">% STORE: Plot Data</span>
0054         <span class="comment">% Eliminates leading 0 in data set if needed</span>
0055         <span class="keyword">if</span> RUSdata.p.Signal_X.data(1) == 0 || RUSdata.p.Signal_Y.data(1) == 0
0056             tdms_data(i).signal_x        = RUSdata.p.Signal_X.data(5:length(RUSdata.p.Signal_X.data));
0057             tdms_data(i).signal_y        = RUSdata.p.Signal_Y.data(5:length(RUSdata.p.Signal_Y.data));
0058             tdms_data(i).frequency       = RUSdata.p.Frequency.data(5:length(RUSdata.p.Frequency.data));
0059         <span class="keyword">else</span>
0060             tdms_data(i).signal_x        = RUSdata.p.Signal_X.data;
0061             tdms_data(i).signal_y        = RUSdata.p.Signal_Y.data;
0062             tdms_data(i).frequency       = RUSdata.p.Frequency.data;
0063         <span class="keyword">end</span>
0064 
0065         <span class="comment">% CHECK: if peaks were found in the tdms file</span>
0066         <span class="keyword">if</span> ~isfield(RUSdata,<span class="string">'fit'</span>)
0067             <span class="keyword">continue</span>
0068         <span class="keyword">end</span>
0069 
0070         <span class="comment">% Store Peak Information ------------------------------------------</span>
0071         
0072         <span class="comment">% GET: peak field_names -&gt; [cell-array] field_names</span>
0073         peak_struct = RUSdata.fit;
0074         field_names = fieldnames(peak_struct);
0075         
0076         unique_fields = {<span class="string">'Peak'</span>,<span class="string">'F'</span>,<span class="string">'Width'</span>,<span class="string">'Amplitude'</span>,<span class="string">'Phase'</span>,<span class="string">'Xbg'</span>,<span class="string">'Ybg'</span>};
0077         struct_fields = {<span class="string">'Frequencies'</span>,<span class="string">'F'</span>,<span class="string">'Width'</span>,<span class="string">'Amplitude'</span>,<span class="string">'Phase'</span>,<span class="string">'Xbg'</span>,<span class="string">'Ybg'</span>};
0078         map = containers.Map(unique_fields,ones(1,length(unique_fields)));
0079 
0080         <span class="keyword">for</span> j = 1:length(field_names)
0081             <span class="keyword">for</span> k = 1:length(unique_fields)
0082                 <span class="keyword">if</span> contains(field_names{j}, unique_fields(k))
0083                     tdms_data(i).peaks_mag_given(map(unique_fields{k})).(struct_fields{k}) = <span class="keyword">...</span>
0084                         peak_struct.(field_names{j}).data;
0085                     map(unique_fields{k}) = map(unique_fields{k}) + 1;
0086                 <span class="keyword">end</span>
0087             <span class="keyword">end</span>
0088         <span class="keyword">end</span>
0089 
0090     <span class="keyword">end</span>
0091 <span class="keyword">end</span>
0092</pre></div>
<hr><address>Generated on Sun 19-Aug-2018 19:01:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>